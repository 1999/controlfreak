function method(g,n){return function(){g[n].apply(g,arguments)}}var StopIteration={toString:function(){return"StopIteration"}};function forEach(g,n){if(g.next)try{for(;;)n(g.next())}catch(k){if(k!=StopIteration)throw k;}else for(var l=0;l<g.length;l++)n(g[l])}function map(g,n){var k=[];forEach(g,function(l){k.push(n(l))});return k}function matcher(g){return function(n){return g.test(n)}}function hasClass(g,n){var k=g.className;return k&&RegExp("(^| )"+n+"($| )").test(k)}
function removeClass(g,n){g.className=g.className.replace(RegExp(" "+n+"\\b","g"),"");return g}function insertAfter(g,n){n.parentNode.insertBefore(g,n.nextSibling);return g}function removeElement(g){g.parentNode&&g.parentNode.removeChild(g)}function clearElement(g){for(;g.firstChild;)g.removeChild(g.firstChild)}function isAncestor(g,n){for(;n=n.parentNode;)if(g==n)return true;return false}var nbsp="\u00a0",matching={"{":"}","[":"]","(":")","}":"{","]":"[",")":"("};
function normalizeEvent(g){if(!g.stopPropagation){g.stopPropagation=function(){this.cancelBubble=true};g.preventDefault=function(){this.returnValue=false}}if(!g.stop)g.stop=function(){this.stopPropagation();this.preventDefault()};if(g.type=="keypress"){g.code=g.charCode==null?g.keyCode:g.charCode;g.character=String.fromCharCode(g.code)}return g}
function addEventHandler(g,n,k,l){function o(p){k(normalizeEvent(p||window.event))}if(typeof g.addEventListener=="function"){g.addEventListener(n,o,false);if(l)return function(){g.removeEventListener(n,o,false)}}else{g.attachEvent("on"+n,o);if(l)return function(){g.detachEvent("on"+n,o)}}}function nodeText(g){return g.textContent||g.innerText||g.nodeValue||""}function nodeTop(g){for(var n=0;g.offsetParent;){n+=g.offsetTop;g=g.offsetParent}return n}
function isBR(g){g=g.nodeName;return g=="BR"||g=="br"}function isSpan(g){g=g.nodeName;return g=="SPAN"||g=="span"};var stringStream=function(g){function n(){for(;l==k.length;){o+=k;k="";l=0;try{k=g.next()}catch(p){if(p!=StopIteration)throw p;else return false}}return true}var k="",l=0,o="";return{peek:function(){if(!n())return null;return k.charAt(l)},next:function(){if(!n())if(o.length>0)throw"End of stringstream reached without emptying buffer ('"+o+"').";else throw StopIteration;return k.charAt(l++)},get:function(){var p=o;o="";if(l>0){p+=k.slice(0,l);k=k.slice(l);l=0}return p},push:function(p){k=k.slice(0,
l)+p+k.slice(l)},lookAhead:function(p,u,a,c){function d(j){return c?j.toLowerCase():j}p=d(p);var b=false,f=o,e=l;for(a&&this.nextWhileMatches(/[\s\u00a0]/);;){a=l+p.length;var h=k.length-l;if(a<=k.length){b=p==d(k.slice(l,a));l=a;break}else if(p.slice(0,h)==d(k.slice(l))){o+=k;k="";try{k=g.next()}catch(i){if(i!=StopIteration)throw i;break}l=0;p=p.slice(h)}else break}if(!(b&&u)){k=o.slice(f.length)+k;l=e;o=f}return b},lookAheadRegex:function(p,u){if(p.source.charAt(0)!="^")throw Error("Regexps passed to lookAheadRegex must start with ^");
for(;k.indexOf("\n",l)==-1;)try{k+=g.next()}catch(a){if(a!=StopIteration)throw a;break}var c=k.slice(l).match(p);if(c&&u)l+=c[0].length;return c},more:function(){return this.peek()!==null},applies:function(p){var u=this.peek();return u!==null&&p(u)},nextWhile:function(p){for(var u;(u=this.peek())!==null&&p(u);)this.next()},matches:function(p){var u=this.peek();return u!==null&&p.test(u)},nextWhileMatches:function(p){for(var u;(u=this.peek())!==null&&p.test(u);)this.next()},equals:function(p){return p===
this.peek()},endOfLine:function(){var p=this.peek();return p==null||p=="\n"}}};var select={};
(function(){function g(b,f){for(;b&&b.parentNode!=f;)b=b.parentNode;return b}function n(b,f){for(;!b.previousSibling&&b.parentNode!=f;)b=b.parentNode;return g(b.previousSibling,f)}function k(b){var f=b.nextSibling;if(f){for(;f.firstChild;)f=f.firstChild;return f.nodeType==3||isBR(f)?f:k(f)}else{for(b=b.parentNode;b&&!b.nextSibling;)b=b.parentNode;return b&&k(b)}}select.ie_selection=document.selection&&document.selection.createRangeCollection;select.scrollToNode=function(b,f){if(b){for(var e=b,h=document.body,
i=document.documentElement,j=!e.nextSibling||!e.nextSibling.nextSibling||!e.nextSibling.nextSibling.nextSibling,m=0;e&&!e.offsetTop;){m++;e=e.previousSibling}if(m==0)j=false;if(!(webkit&&e&&e.offsetTop==5&&e.offsetLeft==5)){m=m*(e?e.offsetHeight:0);var r=0,s=b?b.offsetWidth:0;for(e=e;e&&e.offsetParent;){m+=e.offsetTop;isBR(e)||(r+=e.offsetLeft);e=e.offsetParent}e=h.scrollLeft||i.scrollLeft||0;h=h.scrollTop||i.scrollTop||0;var t=false,x=window.innerWidth||i.clientWidth||0;if(f||s<x){if(f){var z=select.offsetInNode(b),
v=nodeText(b).length;if(v)r+=s*(z/v)}s=r-e;if(s<0||s>x){e=r;t=true}}r=m-h;if(r<0||j||r>(window.innerHeight||i.clientHeight||0)-50){h=j?1E6:m;t=true}t&&window.scrollTo(e,h)}}};select.scrollToCursor=function(b){select.scrollToNode(select.selectionTopNode(b,true)||b.firstChild,true)};var l=null;select.snapshotChanged=function(){if(l)l.changed=true};select.snapshotReplaceNode=function(b,f,e,h){function i(j){if(b==j.node){l.changed=true;if(e&&j.offset>e)j.offset-=e;else{j.node=f;j.offset+=h||0}}else if(select.ie_selection&&
j.offset==0&&j.node==k(b))l.changed=true}if(l){i(l.start);i(l.end)}};select.snapshotMove=function(b,f,e,h,i){function j(m){if(b==m.node&&(!i||m.offset==0)){l.changed=true;m.node=f;m.offset=h?Math.max(0,m.offset+e):e}}if(l){j(l.start);j(l.end)}};if(select.ie_selection){var o=function(){var b=document.selection;if(!b)return null;return b.createRange?b.createRange():b.createTextRange()},p=function(b){function f(s){for(var t=null;!t&&s;){t=s.nextSibling;s=s.parentNode}return e(t)}function e(s){for(;s&&
s.firstChild;)s=s.firstChild;return{node:s,offset:0}}var h=o();h.collapse(b);b=h.parentElement();if(!isAncestor(document.body,b))return null;if(!b.firstChild)return e(b);var i=h.duplicate();i.moveToElementText(b);i.collapse(true);for(var j=b.firstChild;j;j=j.nextSibling){if(j.nodeType==3){var m=j.nodeValue.length;i.move("character",m)}else{i.moveToElementText(j);i.collapse(false)}var r=h.compareEndPoints("StartToStart",i);if(r==0)return f(j);if(r!=1){if(j.nodeType!=3)return e(j);i.setEndPoint("StartToEnd",
h);return{node:j,offset:m-i.text.length}}}return f(b)};select.markSelection=function(){l=null;if(document.selection){var b=p(true),f=p(false);if(b&&f)l={start:b,end:f,changed:false}}};select.selectMarked=function(){function b(h){var i=document.body.createTextRange(),j=h.node;if(j)if(j.nodeType==3){i.moveToElementText(j.parentNode);for(h=h.offset;j.previousSibling;){j=j.previousSibling;h+=(j.innerText||"").length}i.move("character",h)}else{i.moveToElementText(j);i.collapse(true)}else{i.moveToElementText(document.body);
i.collapse(false)}return i}if(l&&l.changed){var f=b(l.start),e=b(l.end);f.setEndPoint("StartToEnd",e);f.select()}};select.offsetInNode=function(b){var f=o();if(!f)return 0;var e=f.duplicate();try{e.moveToElementText(b)}catch(h){return 0}f.setEndPoint("StartToStart",e);return f.text.length};select.selectionTopNode=function(b,f){function e(t,x){if(x.nodeType==3){for(var z=0,v=x.previousSibling;v&&v.nodeType==3;){z+=v.nodeValue.length;v=v.previousSibling}if(v){try{t.moveToElementText(v)}catch(w){return false}t.collapse(false)}else t.moveToElementText(x.parentNode);
z&&t.move("character",z)}else try{t.moveToElementText(x)}catch(B){return false}return true}var h=o();if(!h)return false;var i=h.duplicate();h.collapse(f);var j=h.parentElement();if(j&&isAncestor(b,j)){i.moveToElementText(j);if(h.compareEndPoints("StartToStart",i)==1)return g(j,b)}f=0;for(j=b.childNodes.length-1;f<j;){var m=Math.ceil((j+f)/2),r=b.childNodes[m];if(!r)return false;if(!e(i,r))return false;if(h.compareEndPoints("StartToStart",i)==1)f=m;else j=m-1}if(f==0){h=o();i=h.duplicate();try{i.moveToElementText(b)}catch(s){return null}if(h.compareEndPoints("StartToStart",
i)==0)return null}return b.childNodes[f]||null};select.focusAfterNode=function(b,f){var e=document.body.createTextRange();e.moveToElementText(b||f);e.collapse(!b);e.select()};select.somethingSelected=function(){var b=o();return b&&b.text!=""};var u=function(b){var f=o();if(f){f.pasteHTML(b);f.collapse(false);f.select()}};select.insertNewlineAtCursor=function(){u("<br>")};select.insertTabAtCursor=function(){u("\u00a0\u00a0\u00a0\u00a0")};select.cursorPos=function(b,f){var e=o();if(!e)return null;for(var h=
select.selectionTopNode(b,f);h&&!isBR(h);)h=h.previousSibling;var i=e.duplicate();e.collapse(f);if(h){i.moveToElementText(h);i.collapse(false)}else{try{i.moveToElementText(b)}catch(j){return null}i.collapse(true)}e.setEndPoint("StartToStart",i);return{node:h,offset:e.text.length}};select.setCursorPos=function(b,f,e){function h(j){var m=document.body.createTextRange();if(j.node){m.moveToElementText(j.node);m.collapse(false)}else{m.moveToElementText(b);m.collapse(true)}m.move("character",j.offset);
return m}var i=h(f);e&&e!=f&&i.setEndPoint("EndToEnd",h(e));i.select()};select.getBookmark=function(b){var f=select.cursorPos(b,true);b=select.cursorPos(b,false);if(f&&b)return{from:f,to:b}};select.setBookmark=function(b,f){f&&select.setCursorPos(b,f.from,f.to)}}else{var a=function(b,f){for(;b.nodeType!=3&&!isBR(b);){var e=b.childNodes[f]||b.nextSibling;for(f=0;!e&&b.parentNode;){b=b.parentNode;e=b.nextSibling}b=e;if(!e)break}return{node:b,offset:f}};select.markSelection=function(){var b=window.getSelection();
if(!b||b.rangeCount==0)return l=null;b=b.getRangeAt(0);l={start:a(b.startContainer,b.startOffset),end:a(b.endContainer,b.endOffset),changed:false}};select.selectMarked=function(){function b(){if(e.start.node==e.end.node&&e.start.offset==e.end.offset){var i=window.getSelection();if(!i||i.rangeCount==0)return true;i=i.getRangeAt(0);i=a(i.startContainer,i.startOffset);return e.start.node!=i.node||e.start.offset!=i.offset}}function f(i,j){if(i.node)i.offset==0?h["set"+j+"Before"](i.node):h["set"+j](i.node,
i.offset);else h.setStartAfter(document.body.lastChild||document.body)}var e=l;if(e&&(e.changed||webkit&&b())){var h=document.createRange();f(e.end,"End");f(e.start,"Start");c(h)}};var c=function(b){var f=window.getSelection();if(f){f.removeAllRanges();f.addRange(b)}},d=function(){var b=window.getSelection();return!b||b.rangeCount==0?false:b.getRangeAt(0)};select.selectionTopNode=function(b,f){var e=d();if(!e)return false;var h=f?e.startContainer:e.endContainer,i=f?e.startOffset:e.endOffset;window.opera&&
!f&&e.endContainer==b&&e.endOffset==e.startOffset+1&&b.childNodes[e.startOffset]&&isBR(b.childNodes[e.startOffset])&&i--;return h.nodeType==3?i>0?g(h,b):n(h,b):h.nodeName.toUpperCase()=="HTML"?i==1?null:b.lastChild:h==b?i==0?null:h.childNodes[i-1]:i==h.childNodes.length?g(h,b):i==0?n(h,b):g(h.childNodes[i-1],b)};select.focusAfterNode=function(b,f){var e=document.createRange();e.setStartBefore(f.firstChild||f);if(b&&!b.firstChild)e.setEndAfter(b);else b?e.setEnd(b,b.childNodes.length):e.setEndBefore(f.firstChild||
f);e.collapse(false);c(e)};select.somethingSelected=function(){var b=d();return b&&!b.collapsed};select.offsetInNode=function(b){var f=d();if(!f)return 0;f=f.cloneRange();f.setStartBefore(b);return f.toString().length};select.insertNodeAtCursor=function(b){var f=d();if(f){f.deleteContents();f.insertNode(b);webkitLastLineHack(document.body);if(window.opera&&isBR(b)&&isSpan(b.parentNode)){f=b.nextSibling;var e=b.parentNode,h=e.parentNode;h.insertBefore(b,e.nextSibling);for(e="";f&&f.nodeType==3;f=f.nextSibling){e+=
f.nodeValue;removeElement(f)}h.insertBefore(makePartSpan(e,document),b.nextSibling)}f=document.createRange();f.selectNode(b);f.collapse(false);c(f)}};select.insertNewlineAtCursor=function(){select.insertNodeAtCursor(document.createElement("BR"))};select.insertTabAtCursor=function(){select.insertNodeAtCursor(document.createTextNode("\u00a0\u00a0\u00a0\u00a0"))};select.cursorPos=function(b,f){var e=d();if(e){for(var h=select.selectionTopNode(b,f);h&&!isBR(h);)h=h.previousSibling;e=e.cloneRange();e.collapse(f);
h?e.setStartAfter(h):e.setStartBefore(b);e=e.toString();return{node:h,offset:e.length}}};select.setCursorPos=function(b,f,e){function h(j,m,r){function s(v){v.nodeType==3?t.push(v):forEach(v.childNodes,s)}if(m==0&&j&&!j.nextSibling){i["set"+r+"After"](j);return true}if(j=j?j.nextSibling:b.firstChild){if(m==0){i["set"+r+"Before"](j);return true}for(var t=[];;){for(;j&&!t.length;){s(j);j=j.nextSibling}var x=t.shift();if(!x)return false;var z=x.nodeValue.length;if(z>=m){i["set"+r](x,m);return true}m-=
z}}}var i=document.createRange();e=e||f;h(e.node,e.offset,"End")&&h(f.node,f.offset,"Start")&&c(i)}}})();function UndoHistory(g,n,k,l){this.container=g;this.maxDepth=n;this.commitDelay=k;this.editor=l;this.last=this.first=g={text:"",from:null,to:null};this.firstTouched=false;this.history=[];this.redoHistory=[];this.touched=[];this.lostundo=0}
UndoHistory.prototype={scheduleCommit:function(){var g=this;parent.clearTimeout(this.commitTimeout);this.commitTimeout=parent.setTimeout(function(){g.tryCommit()},this.commitDelay)},touch:function(g){this.setTouched(g);this.scheduleCommit()},undo:function(){this.commit();if(this.history.length){var g=this.history.pop();this.redoHistory.push(this.updateTo(g,"applyChain"));this.notifyEnvironment();return this.chainNode(g)}},redo:function(){this.commit();if(this.redoHistory.length){var g=this.redoHistory.pop();
this.addUndoLevel(this.updateTo(g,"applyChain"));this.notifyEnvironment();return this.chainNode(g)}},clear:function(){this.history=[];this.redoHistory=[];this.lostundo=0},historySize:function(){return{undo:this.history.length,redo:this.redoHistory.length,lostundo:this.lostundo}},push:function(g,n,k){for(var l=[],o=0;o<k.length;o++){var p=o==k.length-1?n:document.createElement("br");l.push({from:g,to:p,text:cleanText(k[o])});g=p}this.pushChains([l],g==null&&n==null);this.notifyEnvironment()},pushChains:function(g,
n){this.commit(n);this.addUndoLevel(this.updateTo(g,"applyChain"));this.redoHistory=[]},chainNode:function(g){for(var n=0;n<g.length;n++){var k=g[n][0];if(k=k&&(k.from||k.to))return k}},reset:function(){this.history=[];this.redoHistory=[];this.lostundo=0},textAfter:function(g){return this.after(g).text},nodeAfter:function(g){return this.after(g).to},nodeBefore:function(g){return this.before(g).from},tryCommit:function(){!window||!window.parent||!window.UndoHistory||(this.editor.highlightDirty()?this.commit(true):
this.scheduleCommit())},commit:function(g){parent.clearTimeout(this.commitTimeout);g||this.editor.highlightDirty(true);g=this.touchedChains();if(g.length){this.addUndoLevel(this.updateTo(g,"linkChain"));this.redoHistory=[];this.notifyEnvironment()}},updateTo:function(g,n){for(var k=[],l=[],o=0;o<g.length;o++){k.push(this.shadowChain(g[o]));l.push(this[n](g[o]))}n=="applyChain"&&this.notifyDirty(l);return k},notifyDirty:function(g){forEach(g,method(this.editor,"addDirtyNode"));this.editor.scheduleHighlight()},
notifyEnvironment:function(){this.onChange&&this.onChange(this.editor);window.frameElement&&window.frameElement.CodeMirror.updateNumbers&&window.frameElement.CodeMirror.updateNumbers()},linkChain:function(g){for(var n=0;n<g.length;n++){var k=g[n];if(k.from)k.from.historyAfter=k;else this.first=k;if(k.to)k.to.historyBefore=k;else this.last=k}},after:function(g){return g?g.historyAfter:this.first},before:function(g){return g?g.historyBefore:this.last},setTouched:function(g){if(g){if(!g.historyTouched){this.touched.push(g);
g.historyTouched=true}}else this.firstTouched=true},addUndoLevel:function(g){this.history.push(g);if(this.history.length>this.maxDepth){this.history.shift();lostundo+=1}},touchedChains:function(){function g(a,c){if(a)a.historyTemp=c;else o=c}function n(a){for(var c=[],d=a?a.nextSibling:l.container.firstChild;d&&(!isBR(d)||d.hackBR);d=d.nextSibling)!d.hackBR&&d.currentText&&c.push(d.currentText);return{from:a,to:d,text:cleanText(c.join(""))}}function k(a,c){for(var d=c+"Sibling",b=a[d];b&&!isBR(b);)b=
b[d];return b}var l=this,o=null,p=[];l.firstTouched&&l.touched.push(null);forEach(l.touched,function(a){if(!(a&&(a.parentNode!=l.container||a.hackBR))){if(a)a.historyTouched=false;else l.firstTouched=false;var c=n(a),d=l.after(a);if(!d||d.text!=c.text||d.to!=c.to){p.push(c);g(a,c)}}});var u=[];l.touched=[];forEach(p,function(a){if(a.from?a.from.historyTemp:o){for(var c=[],d=a.from,b=true;;){var f=d?d.historyTemp:o;if(!f)if(b)break;else f=n(d);c.unshift(f);g(d,null);if(!d)break;b=l.after(d);d=k(d,
"previous")}d=a.to;for(b=l.before(a.from);;){if(!d)break;f=d?d.historyTemp:o;if(!f)if(b)break;else f=n(d);c.push(f);g(d,null);b=l.before(d);d=k(d,"next")}u.push(c)}});return u},shadowChain:function(g){var n=[],k=this.after(g[0].from);for(g=g[g.length-1].to;;){n.push(k);k=k.to;if(!k||k==g)break;else k=k.historyAfter||this.before(g)}return n},applyChain:function(g){var n=select.cursorPos(this.container,false),k=this,l=g[0].from,o=g[g.length-1].to;(function(b,f){for(var e=b?b.nextSibling:k.container.firstChild;e!=
f;){var h=e.nextSibling;removeElement(e);e=h}})(l,o);for(var p=0;p<g.length;p++){var u=g[p];p>0&&k.container.insertBefore(u.from,o);var a=makePartSpan(fixSpaces(u.text));k.container.insertBefore(a,o);if(n&&n.node==u.from){a=0;var c=this.after(u.from);if(c&&p==g.length-1){for(var d=0;d<n.offset&&u.text.charAt(d)==c.text.charAt(d);d++);if(n.offset>d)a=u.text.length-c.text.length}select.setCursorPos(this.container,{node:u.from,offset:Math.max(0,n.offset+a)})}else n&&p==g.length-1&&n.node&&n.node.parentNode!=
this.container&&select.setCursorPos(this.container,{node:u.from,offset:u.text.length})}this.linkChain(g);return l}};var internetExplorer=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent),webkit=/AppleWebKit/.test(navigator.userAgent),safari=/Apple Computer, Inc/.test(navigator.vendor),gecko=navigator.userAgent.match(/gecko\/(\d{8})/i);if(gecko)gecko=Number(gecko[1]);var mac=/Mac/.test(navigator.platform),brokenOpera=window.opera&&/Version\/10.[56]/.test(navigator.userAgent),slowWebkit=/AppleWebKit\/533/.test(navigator.userAgent);
function makeWhiteSpace(g){for(var n=[],k=true;g>0;g--){n.push(k||g==1?nbsp:" ");k^=true}return n.join("")}function fixSpaces(g){if(g.charAt(0)==" ")g=nbsp+g.slice(1);return g.replace(/\t/g,function(){return makeWhiteSpace(indentUnit)}).replace(/[ \u00a0]{2,}/g,function(n){return makeWhiteSpace(n.length)})}function cleanText(g){return g.replace(/\u00a0/g," ").replace(/\u200b/g,"")}
function makePartSpan(g){var n=g;if(g.nodeType==3)n=g.nodeValue;else g=document.createTextNode(n);var k=document.createElement("span");k.isPart=true;k.appendChild(g);k.currentText=n;return k}function alwaysZero(){return 0}var webkitLastLineHack=webkit?function(g){var n=g.lastChild;if(!n||!n.hackBR){n=document.createElement("br");n.hackBR=true;g.appendChild(n)}}:function(){};
function asEditorLines(g){var n=makeWhiteSpace(indentUnit);return map(g.replace(/\t/g,n).replace(/\u00a0/g," ").replace(/\r\n?/g,"\n").split("\n"),fixSpaces)}
var Editor=function(){function g(a,c){function d(e,h){if(e.nodeType==3){if((e.nodeValue=fixSpaces(e.nodeValue.replace(/[\r\u200b]/g,"").replace(/\n/g," "))).length)f=false;b.push(e)}else if(isBR(e)&&e.childNodes.length==0){f=true;b.push(e)}else{for(var i=e.firstChild;i;i=i.nextSibling)d(i);if(!f&&u.hasOwnProperty(e.nodeName.toUpperCase())){f=true;if(!c||!h)b.push(document.createElement("br"))}}}var b=[],f=true;d(a,true);return b}function n(a){function c(e){var h=e.parentNode,i=e.nextSibling;return function(j){h.insertBefore(j,
i)}}var d=[],b=null,f=true;return{next:function(){if(!a)throw StopIteration;var e=a;a=e.nextSibling;var h;if(e.isPart&&e.childNodes.length==1&&e.firstChild.nodeType==3){h=e.firstChild.nodeValue;e.dirty=e.dirty||h!=e.currentText;e.currentText=h;h=!/[\n\t\r]/.test(e.currentText)}else h=false;if(h){d.push(e);f=false;return e.currentText}else if(isBR(e)){f&&window.opera&&e.parentNode.insertBefore(makePartSpan(""),e);d.push(e);f=true;return"\n"}else{h=!e.nextSibling;b=c(e);removeElement(e);e=g(e,h);for(h=
0;h<e.length;h++){var i=e,j=h,m=e[h],r="\n";if(m.nodeType==3){select.snapshotChanged();m=makePartSpan(m);r=m.currentText;f=false}else{f&&window.opera&&b(makePartSpan(""));f=true}m.dirty=true;d.push(m);b(m);i[j]=r}return e.join("")}},nodes:d}}function k(a){for(;a&&!isBR(a);)a=a.previousSibling;return a}function l(a,c){if(a){if(isBR(a))a=a.nextSibling}else a=c.firstChild;for(;a&&!isBR(a);)a=a.nextSibling;return a}function o(a,c,d,b){function f(j){j=cleanText(a.history.textAfter(j));return b?j.toLowerCase():
j}this.editor=a;this.history=a.history;this.history.commit();this.valid=!!c;this.atOccurrence=false;if(b==undefined)b=typeof c=="string"&&c==c.toLowerCase();var e={node:null,offset:0},h=this;if(d&&typeof d=="object"&&typeof d.character=="number"){a.checkLine(d.line);d={node:d.line,offset:d.character};this.pos={from:d,to:d}}else this.pos=d?{from:select.cursorPos(a.container,true)||e,to:select.cursorPos(a.container,false)||e}:{from:e,to:e};if(typeof c!="string")this.matches=function(j,m,r){if(j){j=
f(m).slice(0,r);var s=j.match(c);for(r=0;s;){var t=j.indexOf(s[0]);r+=t;j=j.slice(t+1);if(t=j.match(c))s=t;else break}}else{j=f(m).slice(r);r=(s=j.match(c))&&r+j.indexOf(s[0])}if(s){h.currentMatch=s;return{from:{node:m,offset:r},to:{node:m,offset:r+s[0].length}}}};else{if(b)c=c.toLowerCase();var i=c.split("\n");this.matches=i.length==1?function(j,m,r){var s=f(m),t=c.length,x;if(j?r>=t&&(x=s.lastIndexOf(c,r-t))!=-1:(x=s.indexOf(c,r))!=-1)return{from:{node:m,offset:x},to:{node:m,offset:x+t}}}:function(j,
m,r){var s=j?i.length-1:0,t=i[s],x=f(m),z=j?x.indexOf(t)+t.length:x.lastIndexOf(t);if(!(j?z>=r||z!=t.length:z<=r||z!=x.length-t.length))for(r=m;;){if(j&&!r)break;r=j?this.history.nodeBefore(r):this.history.nodeAfter(r);if(!j&&!r)break;x=f(r);t=i[j?--s:++s];if(s>0&&s<i.length-1)if(x!=t)break;else continue;s=j?x.lastIndexOf(t):x.indexOf(t)+t.length;if(j?s!=x.length-t.length:s!=t.length)break;return{from:{node:j?r:m,offset:j?s:z},to:{node:j?m:r,offset:j?z:s}}}}}}function p(a){this.options=a;window.indentUnit=
a.indentUnit;var c=this.container=document.body;this.history=new UndoHistory(c,a.undoDepth,a.undoDelay,this);var d=this;if(!p.Parser)throw"No parser loaded.";a.parserConfig&&p.Parser.configure&&p.Parser.configure(a.parserConfig);!a.readOnly&&!internetExplorer&&select.setCursorPos(c,{node:null,offset:0});this.dirty=[];this.importCode(a.content||"");this.history.onChange=a.onChange;if(a.readOnly){if(!a.textWrapping)c.style.whiteSpace="nowrap"}else{if(a.continuousScanning!==false){this.scanner=this.documentScanner(a.passTime);
this.delayScanning()}var b=function(){if(document.body.contentEditable!=undefined&&internetExplorer)document.body.contentEditable="true";else document.designMode="on";if(internetExplorer&&a.height!="dynamic")document.body.style.minHeight=window.frameElement.clientHeight-2*document.body.offsetTop-5+"px";document.documentElement.style.borderWidth="0";if(!a.textWrapping)c.style.whiteSpace="nowrap"};try{b()}catch(f){var e=addEventHandler(document,"focus",function(){e();b()},true)}addEventHandler(document,
"keydown",method(this,"keyDown"));addEventHandler(document,"keypress",method(this,"keyPress"));addEventHandler(document,"keyup",method(this,"keyUp"));var h=function(){d.cursorActivity(false)};addEventHandler(internetExplorer?document.body:window,"mouseup",h);addEventHandler(document.body,"cut",h);gecko&&addEventHandler(window,"pagehide",function(){d.unloaded=true});addEventHandler(document.body,"paste",function(i){h();var j=null;try{var m=i.clipboardData||window.clipboardData;if(m)j=m.getData("Text")}catch(r){}if(j!==
null){i.stop();d.replaceSelection(j);select.scrollToCursor(d.container)}});this.options.autoMatchParens&&addEventHandler(document.body,"click",method(this,"scheduleParenHighlight"))}}var u={P:true,DIV:true,LI:true};o.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(a){function c(){var h={node:f,offset:e};d.pos={from:h,to:h};return d.atOccurrence=false}if(!this.valid)return false;var d=this,b=a?this.pos.from:this.pos.to,f=b.node,
e=b.offset;if(f&&!f.parentNode){f=null;e=0}for(;;){if(this.pos=this.matches(a,f,e))return this.atOccurrence=true;if(a){if(!f)return c();f=this.history.nodeBefore(f);e=this.history.textAfter(f).length}else{b=this.history.nodeAfter(f);if(!b){e=this.history.textAfter(f).length;return c()}f=b;e=0}}},select:function(){if(this.atOccurrence){select.setCursorPos(this.editor.container,this.pos.from,this.pos.to);select.scrollToCursor(this.editor.container)}},replace:function(a){if(this.atOccurrence){var c=
this.currentMatch;if(c)a=a.replace(/\\(\d)/,function(d,b){return c[b]});this.pos.to=this.editor.replaceRange(this.pos.from,this.pos.to,a);this.atOccurrence=false}},position:function(){if(this.atOccurrence)return{line:this.pos.from.node,character:this.pos.from.offset}}};p.prototype={importCode:function(a){var c=asEditorLines(a);if(!this.options.incrementalLoading||c.length<1E3){this.history.push(null,null,c);this.history.reset()}else{var d=0,b=this,f=function(){var e=c.slice(d,d+1E3);e.push("");b.history.push(b.history.nodeBefore(null),
null,e);b.history.reset();d+=1E3;d<c.length&&parent.setTimeout(f,1E3)};f()}},getCode:function(){if(!this.container.firstChild)return"";var a=[];select.markSelection();forEach(n(this.container.firstChild),method(a,"push"));select.selectMarked();webkit&&this.container.lastChild.hackBR&&a.pop();webkitLastLineHack(this.container);return cleanText(a.join(""))},checkLine:function(a){if(a===false||!(a==null||a.parentNode==this.container||a.hackBR))throw parent.CodeMirror.InvalidLineHandle;},cursorPosition:function(a){if(a==
null)a=true;return(a=select.cursorPos(this.container,a))?{line:a.node,character:a.offset}:{line:null,character:0}},firstLine:function(){return null},lastLine:function(){var a=this.container.lastChild;if(a)a=k(a);if(a&&a.hackBR)a=k(a.previousSibling);return a},nextLine:function(a){this.checkLine(a);a=l(a,this.container);return!a||a.hackBR?false:a},prevLine:function(a){this.checkLine(a);if(a==null)return false;return k(a.previousSibling)},visibleLineCount:function(){for(var a=this.container.firstChild;a&&
isBR(a);)a=a.nextSibling;if(!a)return false;return Math.floor((window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)/a.offsetHeight)},selectLines:function(a,c,d,b){this.checkLine(a);a={node:a,offset:c};c=null;if(b!==undefined){this.checkLine(d);c={node:d,offset:b}}select.setCursorPos(this.container,a,c);select.scrollToCursor(this.container)},lineContent:function(a){var c=[];for(a=a?a.nextSibling:this.container.firstChild;a&&!isBR(a);a=a.nextSibling)c.push(nodeText(a));
return cleanText(c.join(""))},setLineContent:function(a,c){this.history.commit();this.replaceRange({node:a,offset:0},{node:a,offset:this.history.textAfter(a).length},c);this.addDirtyNode(a);this.scheduleHighlight()},removeLine:function(a){for(var c=a?a.nextSibling:this.container.firstChild;c;){var d=c.nextSibling;removeElement(c);if(isBR(c))break;c=d}this.addDirtyNode(a);this.scheduleHighlight()},insertIntoLine:function(a,c,d){var b=null;if(c=="end")b=l(a,this.container);else for(var f=a?a.nextSibling:
this.container.firstChild;f;f=f.nextSibling){if(c==0){b=f;break}var e=nodeText(f);if(e.length>c){b=f.nextSibling;d=e.slice(0,c)+d+e.slice(c);removeElement(f);break}c-=e.length}c=asEditorLines(d);for(d=0;d<c.length;d++){d>0&&this.container.insertBefore(document.createElement("BR"),b);this.container.insertBefore(makePartSpan(c[d]),b)}this.addDirtyNode(a);this.scheduleHighlight()},selectedText:function(){var a=this.history;a.commit();var c=select.cursorPos(this.container,true),d=select.cursorPos(this.container,
false);if(!c||!d)return"";if(c.node==d.node)return a.textAfter(c.node).slice(c.offset,d.offset);var b=[a.textAfter(c.node).slice(c.offset)];for(c=a.nodeAfter(c.node);c!=d.node;c=a.nodeAfter(c))b.push(a.textAfter(c));b.push(a.textAfter(d.node).slice(0,d.offset));return cleanText(b.join("\n"))},replaceSelection:function(a){this.history.commit();var c=select.cursorPos(this.container,true),d=select.cursorPos(this.container,false);if(c&&d){d=this.replaceRange(c,d,a);select.setCursorPos(this.container,
d);webkitLastLineHack(this.container)}},cursorCoords:function(a,c){function d(j,m){var r=-(document.body.scrollTop||document.documentElement.scrollTop||0),s=-(document.body.scrollLeft||document.documentElement.scrollLeft||0)+m;forEach([j,c?null:window.frameElement],function(t){for(;t;){s+=t.offsetLeft;r+=t.offsetTop;t=t.offsetParent}});return{x:s,y:r,yBot:r+j.offsetHeight}}function b(j,m){var r=document.createElement("SPAN");r.appendChild(document.createTextNode(j));try{return m(r)}finally{r.parentNode&&
r.parentNode.removeChild(r)}}var f=select.cursorPos(this.container,a);if(!f)return null;for(var e=f.offset,h=f.node,i=this;e;){h=h?h.nextSibling:this.container.firstChild;f=nodeText(h);if(e<f.length)return b(f.substr(0,e),function(j){j.style.position="absolute";j.style.visibility="hidden";j.className=h.className;i.container.appendChild(j);return d(h,j.offsetWidth)});e-=f.length}return h&&isSpan(h)?d(h,h.offsetWidth):h&&h.nextSibling&&isSpan(h.nextSibling)?d(h.nextSibling,0):b("\u200b",function(j){h?
h.parentNode.insertBefore(j,h.nextSibling):i.container.insertBefore(j,i.container.firstChild);return d(j,0)})},reroutePasteEvent:function(){if(!(this.capturingPaste||window.opera||gecko&&gecko>=20101026)){this.capturingPaste=true;var a=window.frameElement.CodeMirror.textareaHack,c=this.cursorCoords(true,true);a.style.top=c.y+"px";if(internetExplorer)if(c=select.getBookmark(this.container))this.selectionSnapshot=c;parent.focus();a.value="";a.focus();var d=this;parent.setTimeout(function(){d.capturingPaste=
false;window.focus();d.selectionSnapshot&&window.select.setBookmark(d.container,d.selectionSnapshot);var b=a.value;if(b){d.replaceSelection(b);select.scrollToCursor(d.container)}},10)}},replaceRange:function(a,c,d){d=asEditorLines(d);d[0]=this.history.textAfter(a.node).slice(0,a.offset)+d[0];var b=d[d.length-1];d[d.length-1]=b+this.history.textAfter(c.node).slice(c.offset);c=this.history.nodeAfter(c.node);this.history.push(a.node,c,d);return{node:this.history.nodeBefore(c),offset:b.length}},getSearchCursor:function(a,
c,d){return new o(this,a,c,d)},reindent:function(){this.container.firstChild&&this.indentRegion(null,this.container.lastChild)},reindentSelection:function(a){if(select.somethingSelected()){var c=select.selectionTopNode(this.container,true),d=select.selectionTopNode(this.container,false);c===false||d===false||this.indentRegion(c,d,a)}else this.indentAtCursor(a)},grabKeys:function(a,c){this.frozen=a;this.keyFilter=c},ungrabKeys:function(){this.frozen="leave"},setParser:function(a,c){p.Parser=window[a];
(c=c||this.options.parserConfig)&&p.Parser.configure&&p.Parser.configure(c);if(this.container.firstChild){forEach(this.container.childNodes,function(d){if(d.nodeType!=3)d.dirty=true});this.addDirtyNode(this.firstChild);this.scheduleHighlight()}},keyDown:function(a){if(this.frozen=="leave")this.keyFilter=this.frozen=null;if(this.frozen&&(!this.keyFilter||this.keyFilter(a.keyCode,a))){a.stop();this.frozen(a)}else{var c=a.keyCode;this.delayScanning();this.options.autoMatchParens&&this.scheduleParenHighlight();
if(c==13){if(a.ctrlKey&&!a.altKey)this.reparseBuffer();else{select.insertNewlineAtCursor();c=this.options.enterMode;if(c!="flat")this.indentAtCursor(c=="keep"?"keep":undefined);select.scrollToCursor(this.container)}a.stop()}else if(c==9&&this.options.tabMode!="default"&&!a.ctrlKey){this.handleTab(!a.shiftKey);a.stop()}else if(c==32&&a.shiftKey&&this.options.tabMode=="default"){this.handleTab(true);a.stop()}else if(c==36&&!a.shiftKey&&!a.ctrlKey)this.home()&&a.stop();else if(c==35&&!a.shiftKey&&!a.ctrlKey)this.end()&&
a.stop();else if(c==33&&!a.shiftKey&&!a.ctrlKey&&!gecko)this.pageUp()&&a.stop();else if(c==34&&!a.shiftKey&&!a.ctrlKey&&!gecko)this.pageDown()&&a.stop();else if((c==219||c==221)&&a.ctrlKey&&!a.altKey){this.highlightParens(a.shiftKey,true);a.stop()}else if(a.metaKey&&!a.shiftKey&&(c==37||c==39)){var d=select.selectionTopNode(this.container);if(!(d===false||!this.container.firstChild)){if(c==37)select.focusAfterNode(k(d),this.container);else{c=l(d,this.container);select.focusAfterNode(c?c.previousSibling:
this.container.lastChild,this.container)}a.stop()}}else if((a.ctrlKey||a.metaKey)&&!a.altKey)if(a.shiftKey&&c==90||c==89){select.scrollToNode(this.history.redo());a.stop()}else if(c==90||safari&&c==8){select.scrollToNode(this.history.undo());a.stop()}else if(c==83&&this.options.saveFunction){this.options.saveFunction();a.stop()}else c==86&&!mac&&this.reroutePasteEvent()}},keyPress:function(a){var c=this.options.electricChars&&p.Parser.electricChars,d=this;if(this.frozen&&(!this.keyFilter||this.keyFilter(a.keyCode||
a.code,a))||a.code==13||a.code==9&&this.options.tabMode!="default"||a.code==32&&a.shiftKey&&this.options.tabMode=="default")a.stop();else if(mac&&(a.ctrlKey||a.metaKey)&&a.character=="v")this.reroutePasteEvent();else if(c&&c.indexOf(a.character)!=-1)parent.setTimeout(function(){d.indentAtCursor(null)},0);else if(brokenOpera)if(a.code==8){var b=select.selectionTopNode(this.container);d=this;var f=b?b.nextSibling:this.container.firstChild;b!==false&&f&&isBR(f)&&parent.setTimeout(function(){select.selectionTopNode(d.container)==
f&&select.focusAfterNode(f.previousSibling,d.container)},20)}else{if(a.code==46){b=select.selectionTopNode(this.container);d=this;b&&isBR(b)&&parent.setTimeout(function(){select.selectionTopNode(d.container)!=b&&select.focusAfterNode(b,d.container)},20)}}else if(slowWebkit){f=(b=select.selectionTopNode(this.container))?b.nextSibling:this.container.firstChild;if(b&&f&&isBR(f)&&!isBR(b)){var e=document.createTextNode("\u200b");this.container.insertBefore(e,f);parent.setTimeout(function(){if(e.nodeValue==
"\u200b")removeElement(e);else e.nodeValue=e.nodeValue.replace("\u200b","")},20)}}webkit&&!this.options.textWrapping&&setTimeout(function(){var h=select.selectionTopNode(d.container,true);h&&h.nodeType==3&&h.previousSibling&&isBR(h.previousSibling)&&h.nextSibling&&isBR(h.nextSibling)&&h.parentNode.replaceChild(document.createElement("BR"),h.previousSibling)},50)},keyUp:function(a){this.cursorActivity(a.keyCode>=16&&a.keyCode<=18||a.keyCode>=33&&a.keyCode<=40)},indentLineAfter:function(a,c){function d(m){m=
m?m.nextSibling:b.container.firstChild;if(!m||!hasClass(m,"whitespace"))return null;return m}var b=this,f=d(a),e=0,h=f?f.currentText.length:0,i=f?f.nextSibling:a?a.nextSibling:this.container.firstChild;if(c=="keep"){if(a){var j=d(k(a.previousSibling));if(j)e=j.currentText.length}}else{j=a&&i&&i.currentText?i.currentText:"";if(c!=null&&this.options.tabMode!="indent")e=c?h+indentUnit:Math.max(0,h-indentUnit);else if(a)e=a.indentation(j,h,c,i);else if(p.Parser.firstIndentation)e=p.Parser.firstIndentation(j,
h,c,i)}h=e-h;if(h<0)if(e==0){if(i)select.snapshotMove(f.firstChild,i.firstChild||i,0);removeElement(f);f=null}else{select.snapshotMove(f.firstChild,f.firstChild,h,true);f.currentText=makeWhiteSpace(e);f.firstChild.nodeValue=f.currentText}else if(h>0)if(f){f.currentText=makeWhiteSpace(e);f.firstChild.nodeValue=f.currentText;select.snapshotMove(f.firstChild,f.firstChild,h,true)}else{f=makePartSpan(makeWhiteSpace(e));f.className="whitespace";a?insertAfter(f,a):this.container.insertBefore(f,this.container.firstChild);
select.snapshotMove(i&&(i.firstChild||i),f.firstChild,e,false,true)}else f&&select.snapshotMove(f.firstChild,f.firstChild,e,false);h!=0&&this.addDirtyNode(a)},highlightAtCursor:function(){var a=select.selectionTopNode(this.container,true),c=select.selectionTopNode(this.container,false);if(a===false||c===false)return false;select.markSelection();if(this.highlight(a,l(c,this.container),true,20)===false)return false;select.selectMarked();return true},handleTab:function(a){this.options.tabMode=="spaces"&&
!select.somethingSelected()?select.insertTabAtCursor():this.reindentSelection(a)},home:function(){var a=select.selectionTopNode(this.container,true),c=a;if(a===false||!(!a||a.isPart||isBR(a))||!this.container.firstChild)return false;for(;a&&!isBR(a);)a=a.previousSibling;var d=a?a.nextSibling:this.container.firstChild;d&&d!=c&&d.isPart&&hasClass(d,"whitespace")?select.focusAfterNode(d,this.container):select.focusAfterNode(a,this.container);select.scrollToCursor(this.container);return true},end:function(){var a=
select.selectionTopNode(this.container,true);if(a===false)return false;a=l(a,this.container);if(!a)return false;select.focusAfterNode(a.previousSibling,this.container);select.scrollToCursor(this.container);return true},pageUp:function(){var a=this.cursorPosition().line,c=this.visibleLineCount();if(a===false||c===false)return false;c-=2;for(var d=0;d<c;d++){a=this.prevLine(a);if(a===false)break}if(d==0)return false;select.setCursorPos(this.container,{node:a,offset:0});select.scrollToCursor(this.container);
return true},pageDown:function(){var a=this.cursorPosition().line,c=this.visibleLineCount();if(a===false||c===false)return false;c-=2;for(var d=0;d<c;d++){var b=this.nextLine(a);if(b===false)break;a=b}if(d==0)return false;select.setCursorPos(this.container,{node:a,offset:0});select.scrollToCursor(this.container);return true},scheduleParenHighlight:function(){this.parenEvent&&parent.clearTimeout(this.parenEvent);var a=this;this.parenEvent=parent.setTimeout(function(){a.highlightParens()},300)},highlightParens:function(a,
c){function d(x,z){if(x)if(i)if(i.call)i(x,z);else x.className+=" "+i[z?0:1];else{x.style.fontWeight="bold";x.style.color=z?"#8F8":"#F88"}}function b(x){if(x)if(i&&!i.call)removeClass(removeClass(x,i[0]),i[1]);else if(h.options.unmarkParen)h.options.unmarkParen(x);else{x.style.fontWeight="";x.style.color=""}}function f(x){if(x.currentText)return(x=x.currentText.match(/^[\s\u00a0]*([\(\)\[\]{}])[\s\u00a0]*$/))&&x[1]}function e(){for(var x=[],z,v=true,w=m;w;w=s?w.nextSibling:w.previousSibling)if(w.className==
r&&isSpan(w)&&(z=f(w))){if(/[\(\[\{]/.test(z)==s)x.push(z);else if(x.length){if(x.pop()!=matching[z])v=false}else v=false;if(!x.length)break}else if(w.dirty||!isSpan(w)&&!isBR(w))return{node:w,status:"dirty"};return{node:w,status:w&&v}}var h=this,i=this.options.markParen;if(typeof i=="string")i=[i,i];if(!c&&h.highlighted){b(h.highlighted[0]);b(h.highlighted[1])}if(!(!window||!window.parent||!window.select)){this.parenEvent&&parent.clearTimeout(this.parenEvent);this.parenEvent=null;var j,m=select.selectionTopNode(this.container,
true);if(m&&this.highlightAtCursor())if((m=select.selectionTopNode(this.container,true))&&((j=f(m))||(m=m.nextSibling)&&(j=f(m))))for(var r=m.className,s=/[\(\[\{]/.test(j);;){var t=e();if(t.status=="dirty"){this.highlight(t.node,l(t.node));t.node.dirty=false}else{d(m,t.status);d(t.node,t.status);if(c)parent.setTimeout(function(){b(m);b(t.node)},500);else h.highlighted=[m,t.node];a&&t.node&&select.focusAfterNode(t.node.previousSibling,this.container);break}}}},indentAtCursor:function(a){if(this.container.firstChild)if(this.highlightAtCursor()){var c=
select.selectionTopNode(this.container,false);if(c!==false){select.markSelection();this.indentLineAfter(k(c),a);select.selectMarked()}}},indentRegion:function(a,c,d){var b=a=k(a),f=a&&k(a.previousSibling);isBR(c)||(c=l(c,this.container));this.addDirtyNode(a);do{var e=l(b,this.container);b&&this.highlight(f,e,true);this.indentLineAfter(b,d);f=b;b=e}while(b!=c);select.setCursorPos(this.container,{node:a,offset:0},{node:c,offset:0})},cursorActivity:function(a){if(this.unloaded){window.document.designMode=
"off";window.document.designMode="on";this.unloaded=false}if(internetExplorer){this.container.createTextRange().execCommand("unlink");clearTimeout(this.saveSelectionSnapshot);var c=this;this.saveSelectionSnapshot=setTimeout(function(){var f=select.getBookmark(c.container);if(f)c.selectionSnapshot=f},200)}var d=this.options.onCursorActivity;if(!a||d){var b=select.selectionTopNode(this.container,false);if(!(b===false||!this.container.firstChild)){b=b||this.container.firstChild;d&&d(b);if(!a){this.scheduleHighlight();
this.addDirtyNode(b)}}}},reparseBuffer:function(){forEach(this.container.childNodes,function(a){a.dirty=true});this.container.firstChild&&this.addDirtyNode(this.container.firstChild)},addDirtyNode:function(a){if(a=a||this.container.firstChild){for(var c=0;c<this.dirty.length;c++)if(this.dirty[c]==a)return;if(a.nodeType!=3)a.dirty=true;this.dirty.push(a)}},allClean:function(){return!this.dirty.length},scheduleHighlight:function(){var a=this;parent.clearTimeout(this.highlightTimeout);this.highlightTimeout=
parent.setTimeout(function(){a.highlightDirty()},this.options.passDelay)},getDirtyNode:function(){for(;this.dirty.length>0;){var a=this.dirty.pop();try{for(;a&&a.parentNode!=this.container;)a=a.parentNode;if(a&&(a.dirty||a.nodeType==3))return a}catch(c){}}return null},highlightDirty:function(a){if(!window||!window.parent||!window.select)return false;this.options.readOnly||select.markSelection();for(var c,d=a?null:(new Date).getTime()+this.options.passTime;((new Date).getTime()<d||a)&&(c=this.getDirtyNode());){var b=
this.highlight(c,d);b&&b.node&&b.dirty&&this.addDirtyNode(b.node.nextSibling)}this.options.readOnly||select.selectMarked();c&&this.scheduleHighlight();return this.dirty.length==0},documentScanner:function(a){var c=this,d=null;return function(){if(!(!window||!window.parent||!window.select)){if(d&&d.parentNode!=c.container)d=null;select.markSelection();var b=c.highlight(d,(new Date).getTime()+a,true);select.selectMarked();b=b?b.node&&b.node.nextSibling:null;d=d==b?null:b;c.delayScanning()}}},delayScanning:function(){if(this.scanner){parent.clearTimeout(this.documentScan);
this.documentScan=parent.setTimeout(this.scanner,this.options.continuousScanning)}},highlight:function(a,c,d,b){function f(v){if(v){var w=v.oldNextSibling;if(t||w===undefined||v.nextSibling!=w)h.history.touch(v);v.oldNextSibling=v.nextSibling}else{w=h.container.oldFirstChild;if(t||w===undefined||h.container.firstChild!=w)h.history.touch(null);h.container.oldFirstChild=h.container.firstChild}}var e=this.container,h=this,i=this.options.activeTokens,j=typeof c=="number"?c:null;if(!e.firstChild)return false;
for(;a&&(!a.parserFromHere||a.dirty);){if(b!=null&&isBR(a)&&--b<0)return false;a=a.previousSibling}if(a&&!a.nextSibling)return false;var m=n(a?a.nextSibling:e.firstChild);b=stringStream(m);var r=a?a.parserFromHere(b):p.Parser.make(b),s={current:null,get:function(){if(!this.current)this.current=m.nodes.shift();return this.current},next:function(){this.current=null},remove:function(){e.removeChild(this.get());this.current=null},getNonEmpty:function(){for(var v=this.get();v&&isSpan(v)&&v.currentText==
"";)if(window.opera&&(v.previousSibling==null||isBR(v.previousSibling))&&(v.nextSibling==null||isBR(v.nextSibling))){this.next();v=this.get()}else{var w=v;this.remove();v=this.get();select.snapshotMove(w.firstChild,v&&(v.firstChild||v),0)}return v}},t=false,x=true,z=0;forEach(r,function(v){var w=s.getNonEmpty();if(v.value=="\n"){if(!isBR(w))throw"Parser out of sync. Expected BR.";if(w.dirty||!w.indentation)t=true;f(a);a=w;w.parserFromHere=r.copy();w.indentation=v.indentation||alwaysZero;w.dirty=false;
if(j==null&&w==c)throw StopIteration;if(j!=null&&(new Date).getTime()>=j||!t&&!x&&z>1&&!d)throw StopIteration;x=t;t=false;z=0;s.next()}else{if(!isSpan(w))throw"Parser out of sync. Expected SPAN.";if(w.dirty)t=true;z++;if(!w.reduced&&w.currentText==v.value&&w.className==v.style){i&&w.dirty&&i(w,v,h);w.dirty=false;s.next()}else{t=true;var B=makePartSpan(v.value);B.className=v.style;e.insertBefore(B,w);i&&i(B,v,h);v=v.value.length;for(var F=0;v>0;){w=s.get();var G=w.currentText.length;select.snapshotReplaceNode(w.firstChild,
B.firstChild,v,F);if(G>v){w=w;w.currentText=w.currentText.substring(v);w.reduced=true;v=0}else{v-=G;F+=G;s.remove()}}}}});f(a);webkitLastLineHack(this.container);return{node:s.getNonEmpty(),dirty:t}}};return p}();addEventHandler(window,"load",function(){var g=window.frameElement.CodeMirror;g.editor=new Editor(g.options);parent.setTimeout(method(g,"init"),0)});function tokenizer(g,n){function k(o){return o!="\n"&&/^[\s\u00a0]*$/.test(o)}var l={state:n,take:function(o){if(typeof o=="string")o={style:o,type:o};o.content=(o.content||"")+g.get();/\n$/.test(o.content)||g.nextWhile(k);o.value=o.content+g.get();return o},next:function(){if(!g.more())throw StopIteration;var o;if(g.equals("\n")){g.next();return this.take("whitespace")}if(g.applies(k))o="whitespace";else for(;!o;)o=this.state(g,function(p){l.state=p});return this.take(o)}};return l};var tokenizeJavaScript=function(){function g(a,c){for(var d=false;!a.endOfLine();){var b=a.next();if(b==c&&!d)return false;d=!d&&b=="\\"}return d}function n(a,c){return function(d,b){var f=a,e=k(a,c,d,function(i){f=i}),h=e.type=="operator"||e.type=="keyword c"||e.type.match(/^[\[{}\(,;:]$/);if(h!=c||f!=a)b(n(f,h));return e}}function k(a,c,d,b){function f(){d.nextWhileMatches(u);var m=d.get(),r=l.hasOwnProperty(m)&&l.propertyIsEnumerable(m)&&l[m];return r?{type:r.type,style:r.style,content:m}:{type:"variable",
style:"js-variable",content:m}}function e(m){var r="/*";for(m=m=="*";;){if(d.endOfLine())break;var s=d.next();if(s=="/"&&m){r=null;break}m=s=="*"}b(r);return{type:"comment",style:"js-comment"}}function h(){d.nextWhileMatches(o);return{type:"operator",style:"js-operator"}}function i(m){var r=g(d,m);b(r?m:null);return{type:"string",style:"js-string"}}if(a=='"'||a=="'")return i(a);var j=d.next();if(a=="/*")return e(j);else if(j=='"'||j=="'")return i(j);else if(/[\[\]{}\(\),;\:\.]/.test(j))return{type:j,
style:"js-punctuation"};else if(j=="0"&&(d.equals("x")||d.equals("X"))){d.next();d.nextWhileMatches(p);return{type:"number",style:"js-atom"}}else if(/[0-9]/.test(j)){d.nextWhileMatches(/[0-9]/);if(d.equals(".")){d.next();d.nextWhileMatches(/[0-9]/)}if(d.equals("e")||d.equals("E")){d.next();d.equals("-")&&d.next();d.nextWhileMatches(/[0-9]/)}return{type:"number",style:"js-atom"}}else if(j=="/")if(d.equals("*")){d.next();return e(j)}else if(d.equals("/")){g(d,null);return{type:"comment",style:"js-comment"}}else{if(c){g(d,
"/");d.nextWhileMatches(/[gimy]/);a={type:"regexp",style:"js-string"}}else a=h();return a}else return o.test(j)?h():f()}var l=function(){function a(h,i){return{type:h,style:"js-"+i}}var c=a("keyword a","keyword"),d=a("keyword b","keyword"),b=a("keyword c","keyword"),f=a("operator","keyword"),e=a("atom","atom");return{"if":c,"while":c,"with":c,"else":d,"do":d,"try":d,"finally":d,"return":b,"break":b,"continue":b,"new":b,"delete":b,"throw":b,"in":f,"typeof":f,"instanceof":f,"var":a("var","keyword"),
"function":a("function","keyword"),"catch":a("catch","keyword"),"for":a("for","keyword"),"switch":a("switch","keyword"),"case":a("case","keyword"),"default":a("default","keyword"),"true":e,"false":e,"null":e,undefined:e,NaN:e,Infinity:e}}(),o=/[+\-*&%=<>!?|]/,p=/[0-9A-Fa-f]/,u=/[\w\$_]/;return function(a,c){return tokenizer(a,c||n(false,true))}}();var JSParser=Editor.Parser=function(){function g(o,p,u,a,c,d){this.indented=o;this.column=p;this.type=u;if(a!=null)this.align=a;this.prev=c;this.info=d}function n(o){return function(p){var u=p&&p.charAt(0),a=o.type,c=u==a;return a=="vardef"?o.indented+4:a=="form"&&u=="{"?o.indented:a=="stat"||a=="form"?o.indented+indentUnit:o.info=="switch"&&!c?o.indented+(/^(?:case|default)\b/.test(p)?indentUnit:2*indentUnit):o.align?o.column-(c?1:0):o.indented+(c?0:indentUnit)}}var k={atom:true,number:true,variable:true,
string:true,regexp:true},l=false;return{make:function(o,p){function u(q){for(var y=q.length-1;y>=0;y--)D.push(q[y])}function a(){u(arguments);L=true}function c(){u(arguments);L=false}function d(){C={prev:C,vars:{"this":true,arguments:true}}}function b(){C=C.prev}function f(q){if(C){H="js-variabledef";C.vars[q]=true}}function e(q,y){var E=function(){A=new g(J,K,q,null,A,y)};E.lex=true;return E}function h(){if(A.type==")")J=A.indented;A=A.prev}function i(q){return function(y){if(y==q)a();else q==";"?
c():a(arguments.callee)}}function j(){return c(r,j)}function m(){return c(s,m)}function r(q){if(q=="var")a(e("vardef"),F,i(";"),h);else if(q=="keyword a")a(e("form"),s,r,h);else if(q=="keyword b")a(e("form"),r,h);else if(q=="{")a(e("}"),B,h);else if(q==";")a();else if(q=="function")a(N);else if(q=="for")a(e("form"),i("("),e(")"),S,i(")"),h,r,h);else if(q=="variable")a(e("stat"),x);else if(q=="switch")a(e("form"),s,e("}","switch"),i("{"),B,h,h);else if(q=="case")a(s,i(":"));else if(q=="default")a(i(":"));
else q=="catch"?a(e("form"),d,i("("),P,i(")"),r,h,b):c(e("stat"),s,i(";"),h)}function s(q){if(k.hasOwnProperty(q))a(t);else if(q=="function")a(N);else if(q=="keyword c")a(s);else if(q=="(")a(e(")"),s,i(")"),h,t);else if(q=="operator")a(s);else if(q=="[")a(e("]"),w(s,"]"),h,t);else q=="{"?a(e("}"),w(v,"}"),h,t):a()}function t(q,y){if(q=="operator"&&/\+\+|--/.test(y))a(t);else if(q=="operator")a(s);else if(q==";")c();else if(q=="(")a(e(")"),w(s,")"),h,t);else if(q==".")a(z,t);else q=="["&&a(e("]"),
s,i("]"),h,t)}function x(q){q==":"?a(h,r):c(t,i(";"),h)}function z(q){if(q=="variable"){H="js-property";a()}}function v(q){if(q=="variable")H="js-property";k.hasOwnProperty(q)&&a(i(":"),s)}function w(q,y){function E(I){if(I==",")a(q,E);else I==y?a():a(i(y))}return function(I){I==y?a():c(q,E)}}function B(q){q=="}"?a():c(r,B)}function F(q,y){if(q=="variable"){f(y);a(G)}else a()}function G(q,y){if(y=="=")a(s,G);else q==","&&a(F)}function S(q){if(q=="var")a(F,M);else if(q==";")c(M);else q=="variable"?
a(T):c(M)}function T(q,y){y=="in"?a(s):a(t,M)}function M(q,y){if(q==";")a(Q);else y=="in"?a(s):a(s,i(";"),Q)}function Q(q){q==")"?c():a(s)}function N(q,y){if(q=="variable"){f(y);a(N)}else q=="("&&a(d,w(P,")"),r,b)}function P(q,y){if(q=="variable"){f(y);a()}}var O=tokenizeJavaScript(o),D=[l?m:j],C=null,A=new g((p||0)-indentUnit,0,"block",false),K=0,J=0,L,H,R={next:function(){for(;D[D.length-1].lex;)D.pop()();var q=O.next();if(q.type=="whitespace"&&K==0)J=q.value.length;K+=q.value.length;if(q.content==
"\n"){J=K=0;if(!("align"in A))A.align=false;q.indentation=n(A)}if(q.type=="whitespace"||q.type=="comment")return q;if(!("align"in A))A.align=true;for(;;){L=H=false;D.pop()(q.type,q.content);if(L){if(H)q.style=H;else{var y;if(y=q.type=="variable")a:{for(y=C;y;){if(y.vars[q.content]){y=true;break a}y=y.prev}y=false}if(y)q.style="js-localvariable"}return q}}},copy:function(){var q=C,y=A,E=D.concat([]),I=O.state;return function(U){C=q;A=y;D=E.concat([]);K=J=0;O=tokenizeJavaScript(U,I);return R}}};h.lex=
true;return R},electricChars:"{}:",configure:function(o){if(o.json!=null)l=o.json}}}();var CSSParser=Editor.Parser=function(){function g(k,l,o){return function(p){return!k||/^\}/.test(p)?o:l?o+indentUnit*2:o+indentUnit}}var n=function(){function k(u,a){var c=u.next();if(c=="@"){u.nextWhileMatches(/\w/);return"css-at"}else if(c=="/"&&u.equals("*")){a(l);return null}else if(c=="<"&&u.equals("!")){a(o);return null}else if(c=="=")return"css-compare";else if(u.equals("=")&&(c=="~"||c=="|")){u.next();return"css-compare"}else if(c=='"'||c=="'"){a(p(c));return null}else if(c=="#"){u.nextWhileMatches(/\w/);
return"css-hash"}else if(c=="!"){u.nextWhileMatches(/[ \t]/);u.nextWhileMatches(/\w/);return"css-important"}else if(/\d/.test(c)){u.nextWhileMatches(/[\w.%]/);return"css-unit"}else if(/[,.+>*\/]/.test(c))return"css-select-op";else if(/[;{}:\[\]]/.test(c))return"css-punctuation";else{u.nextWhileMatches(/[\w\\\-_]/);return"css-identifier"}}function l(u,a){for(var c=false;!u.endOfLine();){var d=u.next();if(c&&d=="/"){a(k);break}c=d=="*"}return"css-comment"}function o(u,a){for(var c=0;!u.endOfLine();){var d=
u.next();if(c>=2&&d==">"){a(k);break}c=d=="-"?c+1:0}return"css-comment"}function p(u){return function(a,c){for(var d=false;!a.endOfLine();){var b=a.next();if(b==u&&!d)break;d=!d&&b=="\\"}d||c(k);return"css-string"}}return function(u,a){return tokenizer(u,a||k)}}();return{make:function(k,l){l=l||0;var o=n(k),p=false,u=false,a=false,c={next:function(){var d=o.next(),b=d.style,f=d.content;if(b=="css-hash")b=d.style=u?"css-colorcode":"css-identifier";if(b=="css-identifier")if(u)d.style="css-value";else if(!p&&
!a)d.style="css-selector";if(f=="\n")d.indentation=g(p,u,l);if(f=="{"&&a=="@media")a=false;else if(f=="{")p=true;else if(f=="}")p=u=a=false;else if(f==";")u=a=false;else if(p&&b!="css-comment"&&b!="whitespace")u=true;else if(!p&&b=="css-at")a=f;return d},copy:function(){var d=p,b=u,f=o.state;return function(e){o=n(e,f);p=d;u=b;return c}}};return c},electricChars:"}"}}();
